<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>RestBioSamples - Generic Frontend Demo</title>
</head>

<script type="text/javascript" src="https://cdn.lacunasoftware.com/libs/restpki/lacuna-restpki-widget-1.2.1.min.js"
	integrity="sha256-PziIkD0H3D/3KAcwE/u7u8MTbd6k62IlI9mmqzkc9r0="
	crossorigin="anonymous"></script>

<body>
	<h1>RestPkiWidget - Bio Session Demo</h1>
	<script>

		async function livenessTest() {
			let widget = RestPkiWidget.init();

			fetch("/api/bio/sessions/liveness", {
				method: "POST",
			}).then(async (response) => {
				let sessionInfo = await response.json();
				let result = await widget.performBioSession(sessionInfo.sessionUrl);
				fetch("/api/bio/sessions/liveness/completion", {
					method: "POST",
					body: JSON.stringify({
						ticket: result.completeTicket
					}),
					headers: {
						"Content-Type": "application/json"
					}
				}).then(async (response) => {
					let completionResult = await response.json();
					console.log(completionResult);
				});
			});
		}

		async function enrollmentTest() {
			let widget = RestPkiWidget.init();

			fetch("/api/bio/sessions/enrollment", {
				method: "POST",
			}).then(async (response) => {
				let sessionInfo = await response.json();
				let result = await widget.performBioSession(sessionInfo.sessionUrl);
				fetch("/api/bio/sessions/enrollment/completion", {
					method: "POST",
					body: JSON.stringify({
						ticket: result.completeTicket
					}),
					headers: {
						"Content-Type": "application/json"
					}
				}).then(async (response) => {
					let completionResult = await response.json();
					console.log(completionResult);
				});
			});
		}


		async function authenticationTest() {
			let widget = RestPkiWidget.init();

			let subjectId = document.getElementById('authSubjectId').value;
			
			if (!subjectId || subjectId.trim() === '') {
				alert('Por favor, digite o Subject Identifier!');
				return;
			}

			fetch("/api/bio/sessions/authentication", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(subjectId)
			}).then(async (response) => {
				if (!response.ok) {
					alert('Erro: Subject não encontrado ou não cadastrado!');
					return;
				}
				let sessionInfo = await response.json();
				let result = await widget.performBioSession(sessionInfo.sessionUrl);
				fetch("/api/bio/sessions/authentication/completion", {
					method: "POST",
					body: JSON.stringify({
						ticket: result.completeTicket
					}),
					headers: {
						"Content-Type": "application/json"
					}
				}).then(async (response) => {
					let completionResult = await response.json();
					console.log(completionResult);
				});
			}).catch(error => {
				console.error('Erro:', error);
				alert('Erro ao autenticar!');
			});
		}

	</script>
	<a onclick="livenessTest()" href="#">Liveness Test</a><br><br>
	<a onclick="enrollmentTest()" href="#">Enrollment Test</a><br><br>
	<a onclick="authenticationTest()" href="#">Authentication Test</a> - <input type="text" id="authSubjectId" placeholder="Digite o Subject Identifier">
</body>

</html>